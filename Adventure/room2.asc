// room script file

bool zebranaChochla = false;
bool woodCollected = false;
bool filizankaCollected = false;
bool placedWood = false;
bool placedPot = false;
bool setFire = false;
bool wloszczyzna = false;
bool ogorki = false;
bool koperek = false;
bool lisc = false;
bool kostka = false;
bool ziemniaki = false;
bool jogurtCollected = false;
bool discoBall = false;

function room_Load(){
  RemoveWalkableArea(3);
}

function room_AfterFadeIn(){
  mouse.Mode = eModeWalkto;
  RemoveWalkableArea(3);
  backgroundChannel.Stop();
  backgroundChannel = aScene_2_1___Viking_theme.Play();
  walkingSound = false;
  walkingChannel = aWalking_on_wooden_floor.Play();
    if(walkingChannel.IsPlaying){
      walkingChannel.Stop();
    }
  cGod.Animate(0,  10,  1,  eNoBlock, eForwards);
}


function oDoorClosed_AnyClick()
{
  if(cFabien.ActiveInventory != null){
    if(cFabien.ActiveInventory == iSiekiera){
      cFabien.AddInventory(iDrewno);
      oDoorClosed.Visible = false;
      RestoreWalkableArea(3);
      mouse.Mode = eModeWalkto;
      cFabien.ActiveInventory = null;
      woodCollected = true;
      collectedItems++;
      cFabien.LoseInventory(iSiekiera);
      aChopping_wood.Play();
    }
  }
  else{
    mouse.Mode = eModeWalkto;
    cFabien.Walk(3020, 620,  eBlock,  eWalkableAreas);
    RestoreWalkableArea(3);
    oOpenDoors.Visible = true;
    oDoorClosed.Visible = false;
    aDoor_open.Play();
  }
}

function oOpenDoors_AnyClick()
{
   if(cFabien.ActiveInventory != null){
    if(cFabien.ActiveInventory == iSiekiera){
      cFabien.AddInventory(iDrewno);
      collectedItems++;
      oOpenDoors.Visible = false;
      mouse.Mode = eModeWalkto;
      cFabien.ActiveInventory = null;
      woodCollected = true;
      cFabien.LoseInventory(iSiekiera);
      aChopping_wood.Play();
    }
   else{
     cFabien.ActiveInventory = null;
     mouse.Mode = eModeInteract;
   }
  }
  else{
    mouse.Mode = eModeWalkto;
    cFabien.Walk(3020, 620,  eBlock,  eWalkableAreas);
    RemoveWalkableArea(3);
    oOpenDoors.Visible = false;
    oDoorClosed.Visible = true;
    aDoor_close.Play();
  }
}

function oSkrzyniaZ_AnyClick()
{
  mouse.Mode = eModeWalkto;
  cFabien.Walk(2940, 620,  eBlock,  eWalkableAreas);
  oSkrzyniaZ.Visible = false;
  oSkrzyniaO.Visible = true;
  if(filizankaCollected == false){
    filizankaCollected = true;
    cFabien.AddInventory(iFilizanka);
    aPick_up_item.Play();
    //collectedItems++;
  }
}

function OGarnek_AnyClick()
{
  if(oOpenDoors.Visible == true || woodCollected == true){
    mouse.Mode = eModeWalkto;
    cFabien.Walk(3300, 620,  eBlock,  eWalkableAreas);
    oSchody.Visible = false;
    OGarnek.Visible = false;
    cFabien.AddInventory(iGarnek);
    aPick_up_item.Play();
    collectedItems++;
  }
}

function oSiekiera_AnyClick()
{
  mouse.Mode = eModeWalkto;
  cFabien.Walk(680, 620,  eBlock,  eWalkableAreas);
  oSiekiera.Visible = false;
  cFabien.AddInventory(iSiekiera);
  aPick_up_item.Play();
  collectedItems++;
}

function oFiranki_AnyClick()
{
  mouse.Mode = eModeWalkto;
  cFabien.Walk(2550, 620,  eBlock,  eWalkableAreas);
  oFiranki.Visible = false;
  aPick_up_item.Play();
  //cFabien.SpeechView = 4;
  cFabien.ChangeView(3);
  cFabien.SetIdleView(4,  0);
  Display(String.Format("%d", cFabien.View));
}

function oDuzaSkrzyniaZ_AnyClick()
{
  mouse.Mode = eModeWalkto;
  cFabien.Walk(2400,  620,  eBlock,  eWalkableAreas);
  oDuzaSkrzyniaO.Visible = true;
  oDuzaSkrzyniaZ.Visible = false;
  if (zebranaChochla == false){
    zebranaChochla = true;
    cFabien.AddInventory(iJogurt);
    jogurtCollected = true;
    aPick_up_item.Play();
    collectedItems++;
  }
}

function oDuzaSkrzyniaO_AnyClick()
{
  mouse.Mode = eModeWalkto;
  cFabien.Walk(2400,  620,  eBlock,  eWalkableAreas);
  oDuzaSkrzyniaO.Visible = false;
  oDuzaSkrzyniaZ.Visible = true;
}

function oSkrzyniaO_AnyClick()
{
  mouse.Mode = eModeWalkto;
  cFabien.Walk(2940, 620,  eBlock,  eWalkableAreas);
  oSkrzyniaZ.Visible = true;
  oSkrzyniaO.Visible = false;
}


function hHotspot1_UseInv()
{
}

function hHotspot1_Interact()
{
  if(collectedItems < 5){
    cFabien.Say(String.Format("Nie mam wszystkich itemkow %d", collectedItems));
  }
  else if(collectedItems == 5){
    cFabien.Say("Mog$ ju+ gotowa# zupe");
  }
}

function on_call(int value)
{
  if (value == 1){
    oDrewno.Visible = true;  
    oGarnek2.Visible = true;
    cFabien.LoseInventory(iDrewno);
    cFabien.LoseInventory(iGarnek);
    cFabien.LoseInventory(iZapalki);
    cFabien.AddInventory(iWloszczyzna);
    cFabien.AddInventory(iOgorek);
    cFabien.AddInventory(iKoper);
    cFabien.AddInventory(iLisc);
    cFabien.AddInventory(iKostka);
    cFabien.AddInventory(iZiemniaki);
    Wait(4);
    FadeIn(2);
  }
}


function load_stage(){
    cFabien.Walk(1511, 570,  eBlock,  eWalkableAreas);
    cFabien.FaceCharacter(cDruid);
    cFabien.LockView(FABIEN_DANCE);
    cFabien.Animate(0,  5,  1, eNoBlock, eForwards);
    cDruid.LockView(DRUID_DANCE);
    cDruid.Animate(0,  5,  1, eNoBlock, eForwards);
    discoBall = true;
    backgroundChannel.Stop();
    backgroundChannel = aWho_Likes_to_Party.Play();
    oKula.Visible = true;
    while(oKula.Y < 225){
      oKula.Y += 5;
      Wait(5);
    }
    Wait(200);
    oBlysk.SetView(10,  0,  0);
    oBlysk.Visible = true;
    oBlysk.Animate(0,  4,  0, eNoBlock,  eBackwards);
    while(oBlysk.Animating)Wait(1);
    oBlysk.Visible = false;
    cGod.ChangeRoom(2,  1184,  493,  eDirectionDown);
}

function oGarnek2_UseInv()
{
  if (stage == 2){
    if(cFabien.ActiveInventory != null){
      if(wloszczyzna == false){
        if(cFabien.ActiveInventory == iWloszczyzna){
          mouse.Mode = eModeWalkto;
          cFabien.ActiveInventory = null;
          wloszczyzna = true;
          cFabien.LoseInventory(iWloszczyzna);
          aDrop_item_into_the_soup.Play();
        }
        else {
          cFabien.ActiveInventory = null;
          mouse.Mode = eModeWalkto;
        }
      }
      else if (ogorki == false){
        if(cFabien.ActiveInventory == iOgorek){
          mouse.Mode = eModeWalkto;
          cFabien.ActiveInventory = null;
          ogorki = true;
          cFabien.LoseInventory(iOgorek);
          aDrop_item_into_the_soup.Play();
        }
        else {
          cFabien.ActiveInventory = null;
          mouse.Mode = eModeWalkto;
        }
      }
      else if (koperek == false){
        if(cFabien.ActiveInventory == iKoper){
          mouse.Mode = eModeWalkto;
          cFabien.ActiveInventory = null;
          koperek = true;
          cFabien.LoseInventory(iKoper);
          aDrop_item_into_the_soup.Play();
        }
        else {
          cFabien.ActiveInventory = null;
          mouse.Mode = eModeWalkto;
        }
      }
      else if (lisc == false){
        if(cFabien.ActiveInventory == iLisc){
          mouse.Mode = eModeWalkto;
          cFabien.ActiveInventory = null;
          lisc = true;
          cFabien.LoseInventory(iLisc);
          aDrop_item_into_the_soup.Play();
        }
        else {
          cFabien.ActiveInventory = null;
          mouse.Mode = eModeWalkto;
        }
      }
      else if (kostka == false){
        if(cFabien.ActiveInventory == iKostka){
          mouse.Mode = eModeWalkto;
          cFabien.ActiveInventory = null;
          kostka = true;
          cFabien.LoseInventory(iKostka);
          aDrop_item_into_the_soup.Play();
        }
        else {
          cFabien.ActiveInventory = null;
          mouse.Mode = eModeWalkto;
        }
      }
      else if (ziemniaki == false){
        if(cFabien.ActiveInventory == iZiemniaki){
          mouse.Mode = eModeWalkto;
          cFabien.ActiveInventory = null;
          ziemniaki = true;
          cFabien.LoseInventory(iZiemniaki);
          aDrop_item_into_the_soup.Play();
          cDruid.Say("Teraz jogurt.");
          aDrop_item_into_the_soup.Play();
          load_stage();
        }
        else {
          cFabien.ActiveInventory = null;
          mouse.Mode = eModeWalkto;
        }
      }
    }
  }
}

function god_apear(){
  
}

function repeatedly_execute_always()
{
  if(cFabien.Moving && walkingSound == false){
    walkingChannel = aWalking_on_wooden_floor.Play();
    walkingSound = true;
  }
  else if(!cFabien.Moving){
    walkingSound = false;
    if(walkingChannel.IsPlaying){
      walkingChannel.Stop();
    }
  }
  if (stage == 3){
    
  }
}
